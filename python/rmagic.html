<!DOCTYPE html>
<html lang="en">

  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Data science, particle physics and the Chinese language.">
<meta name="author" content="James C. Loach">
<link rel="icon" href="../favicon.ico">

<title>Calling R using rmagic - python</title>

<!-- JQuery -->
<script>
    window.jQuery || document.write('<script src="../theme/js/jquery.min.js"><\/script>')
</script>

<!-- Typekit -->
<script src="https://use.typekit.net/slk1znu.js"></script>
<script>try{Typekit.load({ async: false });}catch(e){}</script>

<!-- Bootstrap core CSS -->
<link rel="stylesheet" href="../theme/css/bootstrap.css" />
<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
<link rel="stylesheet" type="text/css" href="../theme/css/ie10-viewport-bug-workaround.css" />
<!-- Custom styles for this template -->
<link rel="stylesheet" type="text/css" href="../theme/css/style.css" />
<link rel="stylesheet" type="text/css" href="../theme/css/notebooks.css" />


    <meta name="tags" content="general" />

<body>

  <div class="jl-top-ribbon" style="height:6px; position:fixed; width:100%; z-index:1">
    <div class="jl-green jl-ribbon-div-17"></div>
    <div class="jl-blue jl-ribbon-div-17"></div>
    <div class="jl-purple jl-ribbon-div-16"></div>
    <div class="jl-pink jl-ribbon-div-16"></div>
    <div class="jl-orange jl-ribbon-div-17"></div>
    <div class="jl-yellow jl-ribbon-div-17"></div>
  </div>

  <div class="navbar navbar-fixed-top" style="margin-top:6px">

    <div class="container">
      <div class="navbar-header">
         <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
           <span class="icon-bar"></span>
           <span class="icon-bar"></span>
           <span class="icon-bar"></span>
         </button>
         <a class="navbar-brand" href="..">JAMES C. LOACH</a>
      </div>
       <div class="navbar-collapse collapse" id="searchbar">
         <ul class="nav navbar-nav navbar-right">
           <li class="dropdown">
             <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">About<span class="caret"></span></a>
             <ul class="dropdown-menu">
               <li><a href="../pages/about.html">James Loach</a></li>
               <li><a href="https://www.linkedin.com/in/jamesloach">LinkedIn</a></li>
               <li><a href="https://github.com/nepahwin">GitHub</a></li>
             </ul>
           </li>
           <li class="dropdown">
             <a href="#" class="dropdown-toggle" data-toggle="dropdown"
               role="button" aria-haspopup="true" aria-expanded="false">Notes<span class="caret"></span></a>
             <ul class="dropdown-menu">
               <li><a href="..#Chinese">Chinese computing</a></li>
               <li><a href="..#Python">Python</a></li>
               <li><a href="..#pandas">pandas</a></li>
               <li><a href="..#Miscellaneous">Miscellaneous</a></li>
             </ul>
           </li>
           <li class="dropdown">
             <a href="#" class="dropdown-toggle" data-toggle="dropdown"
               role="button" aria-haspopup="true" aria-expanded="false">Projects<span class="caret"></span></a>
             <ul class="dropdown-menu">
               <li><a href="http://sinophenia.com">Sinophenia</a></li>
               <li><a href="http://tangerinechinese.com">Tangerine Chinese</a></li>
               <li><a href="https://radiopurity.org">Radiopurity.org</a></li>
               <li><a href="../pages/maps.html">Map making</a></li>
               <li><a href="../pages/photography.html">Photography</a></li>
             </ul>
           </li>
         </ul>

         <form class="navbar-form" action="../search.html" onsubmit="return validateForm(this.elements['q'].value);">
           <div class="form-group" style="display:inline;">
             <div class="input-group" style="display:table;">
               <span class="input-group-addon" style="width:1%;"><span class="glyphicon glyphicon-search"></span></span>
               <input class="form-control search-query" name="q" id="tipue_search_input" placeholder="" required autocomplete="off" type="text">
             </div>
           </div>
         </form>

       </div>
    </div>
  </div>

  <!-- end of header section -->
  <div class="container">
<div class="row">
  <div class="col-md-10 col-md-offset-1">
    <div class="spacer10"></div>
    <h1 class="text-center">Calling R using rmagic</h1>
    <ol class="breadcrumb text-center">
      <li>
        <time class="published" datetime="2017-08-26T12:00:00+01:00">
          26 August 2017
        </time>
      </li>
      <li>python</li>
      <li>general</li>
    </ol>
  <p>In a Jupyter notebook you can use <code>rmagic</code> which is a part of <a href="https://rpy2.readthedocs.io/en/version_2.8.x/"><code>rpy2</code></a>.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">rpy2</span>
<span class="o">%</span><span class="n">load_ext</span> <span class="n">rpy2</span><span class="o">.</span><span class="n">ipython</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
</pre></div>


<h4>Line magic</h4>
<p><code>%R</code> is line magic and returns values to python.</p>
<div class="highlight"><pre><span></span><span class="o">%</span><span class="n">R</span> <span class="n">X</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span> <span class="n">mean</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>array([ 2.5])
</pre></div>


<div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="o">%</span><span class="n">R</span> <span class="n">X</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span> <span class="n">mean</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>[ 2.5]
</pre></div>


<h4>Cell magic</h4>
<p><code>%%R</code> is cell magic. It returns nothing by default.</p>
<div class="highlight"><pre><span></span><span class="o">%%</span>R
X <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">6</span><span class="p">)</span>
<span class="kp">summary</span><span class="p">(</span>X<span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   1.00    2.25    3.50    3.50    4.75    6.00
</pre></div>


<p>The flags <code>-w</code> and <code>-h</code> can be used to control size of any graphics (<code>-u</code> specifies the unit).</p>
<div class="highlight"><pre><span></span><span class="o">%%</span>R <span class="o">-</span>w <span class="m">300</span> <span class="o">-</span>h <span class="m">300</span> <span class="o">-</span>u px
X <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">6</span><span class="p">)</span>
Y <span class="o">=</span> X<span class="o">**</span><span class="m">2</span>
plot<span class="p">(</span>X<span class="p">,</span> Y<span class="p">)</span>
</pre></div>


<p><img alt="png" src="../images/rmagic_files/rmagic_10_0.png"></p>
<h4>Passing objects back and forth</h4>
<p>This can be done using the <code>-i</code> and <code>-o</code> flags.</p>
<div class="highlight"><pre><span></span><span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="o">%</span><span class="n">R</span> <span class="o">-</span><span class="n">i</span> <span class="n">Z</span> <span class="n">mean</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>array([ 2.5])
</pre></div>


<div class="highlight"><pre><span></span><span class="o">%</span><span class="n">R</span> <span class="o">-</span><span class="n">o</span> <span class="n">W</span> <span class="n">W</span> <span class="o">=</span> <span class="n">Z</span> <span class="o">*</span> <span class="n">mean</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>array([  2.5,   5. ,   7.5,  10. ])
</pre></div>


<p>Use <code>%Rpull</code> to pull back variables from R.</p>
<div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="o">%</span><span class="n">R</span> <span class="n">x</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">3.8</span><span class="p">);</span> <span class="n">y</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span> <span class="n">z</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="o">%</span><span class="n">Rpull</span> <span class="n">x</span>  <span class="n">y</span> <span class="n">z</span>
<span class="k">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="k">[ 1.   2.   3.8]</span>
<span class="k">[ 6.  7.  8.]</span>
<span class="k">[&#39;a&#39; &#39;b&#39; &#39;4&#39;]</span>
</pre></div>


<p>Use <code>%Rget</code> to pull back objects.</p>
<div class="highlight"><pre><span></span><span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;i4&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;f8&#39;</span><span class="p">)]</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">40.5</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">31.5</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">26.1</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">53.4</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
<span class="o">%</span><span class="n">R</span> <span class="o">-</span><span class="n">i</span> <span class="n">data</span>
<span class="o">%</span><span class="n">Rget</span> <span class="n">data</span>
</pre></div>


<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>x</th>
      <th>y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>40.5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>31.5</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>26.1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>53.4</td>
    </tr>
  </tbody>
</table>
</div>

<hr>
<p>If you spot any errors please let me know on <a href="https://twitter.com/jamesloach">twitter</a>.</p>
  </div>
</div>
<br>
  </div>
  <!-- start of footer section -->
  <footer class="footer">
    <div class="container text-center">
      <p class="text-muted">
        <small>Copyright James C. Loach, <time datetime="2017">2017</time>.</small>
      </p>
    </div>
    <div>
      <div class="jl-green jl-ribbon-div-17"></div>
      <div class="jl-blue jl-ribbon-div-17"></div>
      <div class="jl-purple jl-ribbon-div-16"></div>
      <div class="jl-pink jl-ribbon-div-16"></div>
      <div class="jl-orange jl-ribbon-div-17"></div>
      <div class="jl-yellow jl-ribbon-div-17"></div>
    </div>
  </footer>

  <!-- This jQuery line finds any span that contains code highlighting classes and then selects the parent <pre> tag and adds a border. This is done as a workaround to visually distinguish the code inputs and outputs -->

<script>
$( ".hll, .n, .c, .err, .k, .o, .cm, .cp, .c1, .cs, .gd, .ge, .gr, .gh, .gi, .go, .gp, .gs, .gu, .gt, .kc, .kd, .kn, .kp, .kr, .kt, .m, .s, .na, .nb, .nc, .no, .nd, .ni, .ne, .nf, .nl, .nn, .nt, .nv, .ow, .w, .mf, .mh, .mi, .mo, .sb, .sc, .sd, .s2, .se, .sh, .si, .sx, .sr, .s1, .ss, .bp, .vc, .vg, .vi, .il" ).parent( "pre" ).css( "border", "2px solid #eeeae3" ).css("background-color", "#eeeae3");
</script>


  <!-- Bootstrap core JavaScript
    ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  <script src="../theme/js/bootstrap.min.js"></script>
  <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
  <script src="../theme/js/ie10-viewport-bug-workaround.js"></script>
</body>

</html>